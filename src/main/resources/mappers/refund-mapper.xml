<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="refundMapper">
	<resultMap type="Refund" id="resultRefund">
		<result property="refundId" column="REFUND_ID" />
		<result property="bookId" column="BOOK_ID" />
		<result property="clientId" column="CLIENT_ID" />
		<result property="empId" column="EMP_ID" />
		<result property="empName" column="EMP_NAME" />
		<result property="refundNum" column="REFUND_NUM" />
		<result property="refundDate" column="REFUND_DATE" />
		<result property="refundAmount" column="REFUND_AMOUNT" />
		<result property="refundState" column="REFUND_STATE" />
		<result property="remark" column="REMARK" />
	</resultMap>
	
	
	<select id="selectGetListCount" resultType="_int">
		select count(*) from refund
	</select>
	
	<select id="selectRefundList" parameterType="Paging" resultMap="resultRefund">
		<![CDATA[
			SELECT *
			FROM (SELECT ROWNUM RNUM, REFUND_ID, BOOK_ID, CLIENT_ID, EMP_ID, EMP_NAME, REFUND_NUM, REFUND_DATE, REFUND_AMOUNT, REFUND_STATE, REMARK 
			            FROM (SELECT * FROM REFUND
			                  ORDER BY REFUND_DATE DESC))
			WHERE RNUM BETWEEN #{ startRow } AND #{ endRow }
		]]>
	</select>
	
	<select id="selectRefundBookName" parameterType="_int" resultType="string">
		SELECT BOOK_NAME
		FROM  BOOK
		WHERE BOOK_ID= #{ bookId }
	</select>
	
	<select id="selectRefundClientName" parameterType="_int"  resultType="string">
		SELECT CLIENT_NAME
		FROM CLIENT
		WHERE CLIENT_ID = #{ storageId }
	</select>
	
	<select id="selectRefundBookPrice" parameterType="_int"  resultType="_int">
		SELECT BOOK_PRICE
		FROM BOOK
		WHERE BOOK_ID = #{ bookId }
	</select>
	
	<select id="selectRefundCountByDate" parameterType="Search" resultType="_int">
		SELECT COUNT(*) FROM STORE
		WHERE (STORE_DATE between to_date(#{ begin }) and to_date(#{ end }) + 1 - 1/86400) AND CLASSIFY = '출고'
	</select>
	
	<select id="selectRefundByDate" parameterType="Search" resultMap="resultRefund">
		<![CDATA[
			SELECT *
			FROM (SELECT ROWNUM RNUM, REFUND_ID, BOOK_ID, CLIENT_ID, EMP_ID, EMP_NAME, REFUND_NUM, REFUND_DATE, REFUND_AMOUNT, REFUND_STATE, REMARK
			      FROM (SELECT *
			            FROM REFUND
			            WHERE REFUND_DATE between to_date(#{ begin }) and to_date(#{ end }) + 1 - 1/86400
			            ORDER BY REFUND_DATE DESC
			            )
			      )
			WHERE RNUM between #{ startRow } and #{ endRow }
		]]>
	</select>
	
	<delete id="deleteRefund" parameterType="_int">
		DELETE FROM REFUND WHERE REFUND_ID = #{ refundId }
	</delete>
			
	<delete id="deleteInventory" parameterType="_int">
		DELETE FROM INVENTORY WHERE REFUND_ID = #{ refundId }
	</delete>
</mapper>