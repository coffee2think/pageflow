<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="noticeMapper">
	
	
	<resultMap type="Notice" id="resultNotice">
		<result column="NOTICE_ID" property="noticeId" />
		<result column="EMP_ID" property="empId" />
		<result column="EMP_Name" property="empName" />
		<result column="NOTICE_TITLE" property="noticeTitle" />
		<result column="NOTICE_DETAIL" property="noticeDetail" />
		<result column="CREATE_DATE" property="noticeCreateDate" />
		<result column="MODIFY_DATE" property="noticeModifyDate" />
		<result column="DELETE_DATE" property="noticeDeleteDate" />
		<result column="CLASSIFY" property="classify" />
		<result column="IMPORTANCE" property="importance" />
		<result column="NOTICE_READCOUNT" property="noticeReadCount" />
		<result column="NOTICE_ORIGINAL_FILENAME" property="noticeOriginalFileName" />
		<result column="NOTICE_RENAME_FILENAME" property="noticeRenameFileName" />
	</resultMap>
	
	<select id="selectNoticeList" parameterType="Paging" resultMap="resultNotice">
		
			select * from (select rownum rnum, NOTICE_ID, EMP_ID, EMP_Name, NOTICE_TITLE, 
				            NOTICE_DETAIL, CREATE_DATE  ,IMPORTANCE, NOTICE_READCOUNT , NOTICE_ORIGINAL_FILENAME, NOTICE_RENAME_FILENAME 
				      		from (select * from notice 
				      			join employee using (EMP_ID)
				            order by importance desc, CREATE_DATE desc, NOTICE_ID desc)
				     	   ) 
		where rnum between #{ startRow } and #{ endRow }
		
		
	</select>
	
	<select id="selectOne" parameterType="_int" resultMap="resultNotice">
		select * from notice join employee using (EMP_ID) where NOTICE_ID = #{ noticeId}
	</select>	
	
	<select id="getListCount" resultType="_int">
		select count(*) from notice
	</select>
	
	<insert id="insertNotice" parameterType="Notice">
		insert into notice 
		values ((select max(NOTICE_ID) + 1 from notice), 
				#{empId}, #{noticeTitle}, #{noticeDetail}, 
				sysdate, default, default , #{classify},  
				#{importance},default,#{noticeOriginalFileName},#{noticeRenameFileName})
				
	</insert>
	
	<update id="updateNotice" parameterType="Notice">
		update notice 
		<if test="noticeOriginalFileName == null">
		set NOTICE_TITLE = #{noticeTitle}, 
			NOTICE_DETAIL = #{noticeDetail}, 
			NOTICE_ORIGINAL_FILENAME = null, NOTICE_RENAME_FILENAME = null,
			importance = #{importance} 
		where NOTICE_ID = #{noticeId}
		</if>
		<if test="noticeOriginalFileName != null">
		set NOTICE_TITLE = #{noticeTitle},  
			NOTICE_DETAIL = #{noticeDetail}, 
			NOTICE_ORIGINAL_FILENAME = #{noticeOriginalFileName}, NOTICE_RENAME_FILENAME = #{noticeRenameFileName}, 
			importance = #{importance}
		where NOTICE_ID = #{noticeId}
		</if>
	</update>
	
</mapper>






